<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Frozen Envelope Machine | NBA Draft Lottery</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .emojis {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #1d428a;
            margin: 0 0 5px 0;
            font-size: 2rem;
        }
        
        .subtitle {
            color: #777;
            margin: 0;
            font-size: 1rem;
        }
        
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .team-card {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #eee;
        }
        
        .team-logo {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            position: relative;
        }
        
        .team-code {
            position: absolute;
            font-weight: bold;
            font-size: 12px;
        }
        
        .team-info {
            flex-grow: 1;
        }
        
        .team-name {
            font-weight: 600;
            margin: 0;
        }
        
        .team-odds {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        .team-seed {
            font-weight: bold;
            font-size: 18px;
            margin-left: 5px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }
        
        .section-subtitle {
            font-size: 0.9rem;
            color: #777;
            margin: 0;
        }
        
        .run-btn {
            display: block;
            margin: 0 auto 30px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background-color: #c8102e;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.3s;
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.3);
        }
        
        .run-btn:hover {
            background-color: #a70d25;
        }
        
        .run-btn:active {
            transform: scale(0.98);
        }
        
        .run-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .results {
            margin-top: 20px;
        }
        
        .result-row {
            display: flex;
            align-items: center;
            padding: 14px;
            border-bottom: 1px solid #eee;
        }
        
        .result-row.lottery {
            background-color: #fff9e6;
        }
        
        .pick-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #1d428a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .movement {
            margin-left: 5px;
        }
        
        .up {
            color: #22bb33;
        }
        
        .down {
            color: #bb2124;
        }
        
        .lottery-badge {
            margin-left: auto;
            padding: 5px 10px;
            border-radius: 20px;
            background-color: #ffeeba;
            color: #856404;
            font-size: 12px;
            font-weight: 600;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 0;
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            100% {
                transform: translateY(1000px) rotate(720deg);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .hidden {
            display: none;
        }
        
        .stats {
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid #eee;
            font-size: 13px;
            color: #777;
        }
        
        .debug-info {
            font-family: monospace;
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="emojis">üßä ‚úâÔ∏è</div>
            <h1>The Frozen Envelope Machine</h1>
            <p class="subtitle">NBA Draft Lottery Simulator</p>
        </div>
        
        <div class="section-header">
            <h2 class="section-title">Pre-Lottery Order (Worst to Best)</h2>
            <p class="section-subtitle">Based on 2025 NBA Lottery Odds</p>
        </div>
        
        <div id="team-grid" class="team-grid">
            <!-- Teams will be populated here by JavaScript -->
        </div>
        
        <button id="run-btn" class="run-btn">Run The Frozen Envelope Machine</button>
        
        <div id="results" class="results hidden">
            <h2 class="section-title">Draft Results</h2>
            <div id="results-container">
                <!-- Results will be populated here by JavaScript -->
            </div>
            <div id="debug-stats" class="stats hidden">
                <div>Simulation #<span id="sim-count">1</span> | <span id="sim-time"></span></div>
                <div id="debug-info" class="debug-info"></div>
            </div>
        </div>
    </div>

    <script>
        // Team data with colors and odds
        const TEAMS = [
            { code: 'UTA', name: 'Utah Jazz', primary: '#002B5C', secondary: '#F9A01B', odds: 14.0, seed: 1 },
            { code: 'WAS', name: 'Washington Wizards', primary: '#002B5C', secondary: '#E31837', odds: 14.0, seed: 2 },
            { code: 'CHA', name: 'Charlotte Hornets', primary: '#1D1160', secondary: '#00788C', odds: 14.0, seed: 3 },
            { code: 'NO', name: 'New Orleans Pelicans', primary: '#0C2340', secondary: '#C8102E', odds: 12.5, seed: 4 },
            { code: 'PHI', name: 'Philadelphia 76ers', primary: '#006BB6', secondary: '#ED174C', odds: 10.5, seed: 5 },
            { code: 'BKN', name: 'Brooklyn Nets', primary: '#000000', secondary: '#FFFFFF', odds: 9.0, seed: 6 },
            { code: 'TOR', name: 'Toronto Raptors', primary: '#CE1141', secondary: '#000000', odds: 7.5, seed: 7 },
            { code: 'SA', name: 'San Antonio Spurs', primary: '#C4CED4', secondary: '#000000', odds: 6.0, seed: 8 },
            { code: 'PHX', name: 'Phoenix Suns', primary: '#1D1160', secondary: '#E56020', odds: 4.5, seed: 9 },
            { code: 'POR', name: 'Portland Trail Blazers', primary: '#E03A3E', secondary: '#000000', odds: 3.0, seed: 10 },
            { code: 'DAL', name: 'Dallas Mavericks', primary: '#00538C', secondary: '#002B5E', odds: 2.0, seed: 11 },
            { code: 'CHI', name: 'Chicago Bulls', primary: '#CE1141', secondary: '#000000', odds: 1.5, seed: 12 },
            { code: 'SAC', name: 'Sacramento Kings', primary: '#5A2D81', secondary: '#63727A', odds: 1.0, seed: 13 },
            { code: 'ATL', name: 'Atlanta Hawks', primary: '#E03A3E', secondary: '#C1D32F', odds: 0.5, seed: 14 }
        ];
        
        // Lottery odds for picks 1-4
        const LOTTERY_ODDS = {
            1: [14.0, 13.4, 12.7, 12.0],
            2: [14.0, 13.4, 12.7, 12.0],
            3: [14.0, 13.4, 12.7, 12.0],
            4: [12.5, 12.2, 11.9, 11.5],
            5: [10.5, 10.5, 10.6, 10.5],
            6: [9.0, 9.2, 9.4, 9.6],
            7: [7.5, 7.8, 8.1, 8.5],
            8: [6.0, 6.3, 6.7, 7.2],
            9: [4.5, 4.8, 5.2, 5.7],
            10: [3.0, 3.3, 3.6, 4.0],
            11: [2.0, 2.2, 2.4, 2.8],
            12: [1.5, 1.7, 1.9, 2.1],
            13: [1.0, 1.1, 1.2, 1.4],
            14: [0.5, 0.6, 0.6, 0.7]
        };

        // DOM elements
        const teamGrid = document.getElementById('team-grid');
        const runBtn = document.getElementById('run-btn');
        const results = document.getElementById('results');
        const resultsContainer = document.getElementById('results-container');
        const debugStats = document.getElementById('debug-stats');
        const simCount = document.getElementById('sim-count');
        const simTime = document.getElementById('sim-time');
        const debugInfo = document.getElementById('debug-info');
        
        // Simulation counter and results history
        let simulationCounter = 0;
        let lastResults = null;
        
        // Get a crypto-based random number between 0 and 1
        function getSecureRandom() {
            try {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] / (0xffffffff + 1); // Normalize to [0, 1)
            } catch (e) {
                // Fallback to Math.random with added entropy
                return Math.random() * (new Date().getTime() % 1000) / 1000;
            }
        }
        
        // Populate team grid
        function populateTeamGrid() {
            teamGrid.innerHTML = '';
            TEAMS.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.innerHTML = `
                    <div class="team-logo" style="background-color: ${team.primary};">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="${team.secondary}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="${team.primary}" />
                        </svg>
                        <div class="team-code" style="color: ${team.secondary};">${team.code}</div>
                    </div>
                    <div class="team-info">
                        <p class="team-name">${team.name}</p>
                        <p class="team-odds">${team.odds}% chance at #1 pick</p>
                    </div>
                    <div class="team-seed">#${team.seed}</div>
                `;
                teamGrid.appendChild(teamCard);
            });
        }
        
        // Initialize the simulator
        function init() {
            populateTeamGrid();
            runBtn.addEventListener('click', runLottery);
            
            // Show debug info by default to help diagnose issues
            debugStats.classList.remove('hidden');
        }
        
        // Create confetti effect
        function createConfetti() {
            const container = document.querySelector('.container');
            
            // Remove any existing confetti
            document.querySelectorAll('.confetti').forEach(el => el.remove());
            
            // Create new confetti particles
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                const size = getSecureRandom() * 8 + 4;
                const x = getSecureRandom() * 100;
                const y = -getSecureRandom() * 20 - 10;
                const speed = getSecureRandom() * 3 + 2;
                const color = `hsl(${getSecureRandom() * 360}, 70%, 60%)`;
                
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.left = `${x}%`;
                confetti.style.top = `${y}%`;
                confetti.style.backgroundColor = color;
                confetti.style.animationDuration = `${speed}s`;
                
                container.appendChild(confetti);
            }
            
            // Remove confetti after animation
            setTimeout(() => {
                document.querySelectorAll('.confetti').forEach(el => el.remove());
            }, 5000);
        }
        
        // Run the lottery simulation
        function runLottery() {
            runBtn.disabled = true;
            runBtn.textContent = 'Freezing Envelopes...';
            runBtn.style.animation = 'pulse 1s infinite';
            
            // Clear previous results
            resultsContainer.innerHTML = '';
            
            // Force a browser reflow/repaint
            void results.offsetWidth;
            
            // Increment simulation counter
            simulationCounter++;
            simCount.textContent = simulationCounter;
            
            // Add timestamp
            const now = new Date();
            simTime.textContent = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}.${now.getMilliseconds()}`;
            
            // Clear debug info
            debugInfo.innerHTML = '';
            
            // Simulate with a delay for dramatic effect
            setTimeout(() => {
                const startTime = performance.now();
                const draftOrder = simulateDraft();
                const endTime = performance.now();
                
                // Add time info
                debugInfo.innerHTML += `Simulation time: ${(endTime - startTime).toFixed(2)}ms<br>`;
                
                // Check if results are the same as last time
                if (lastResults) {
                    const sameResults = JSON.stringify(draftOrder.map(t => t.code)) === 
                                       JSON.stringify(lastResults.map(t => t.code));
                    debugInfo.innerHTML += `Same as last time: ${sameResults ? 'YES - ERROR!' : 'No - Good!'}<br>`;
                }
                
                // Save current results
                lastResults = [...draftOrder];
                
                // Display results
                displayResults(draftOrder);
                
                // Re-enable the button
                runBtn.disabled = false;
                runBtn.textContent = 'Run The Frozen Envelope Machine';
                runBtn.style.animation = 'none';
                
                // Show results and create confetti
                results.classList.remove('hidden');
                createConfetti();
            }, 1500);
        }
        
        // Simulate the draft lottery
        function simulateDraft() {
            // Create a deep copy of the teams array
            const teamsCopy = JSON.parse(JSON.stringify(TEAMS));
            const draftOrder = [];
            const debugData = [];
            
            // Simulate the first 4 picks (lottery picks)
            for (let pick = 0; pick < 4; pick++) {
                const totalOdds = teamsCopy.reduce((sum, team) => {
                    return sum + LOTTERY_ODDS[team.seed][pick];
                }, 0);
                
                // Get a secure random number
                const random = getSecureRandom() * totalOdds;
                
                // Debug output
                const pickDebug = `Pick ${pick+1}: Random ${random.toFixed(2)}/${totalOdds.toFixed(2)}`;
                debugData.push(pickDebug);
                
                let runningTotal = 0;
                let selectedIndex = -1;
                
                // Find which team gets the pick based on odds
                for (let i = 0; i < teamsCopy.length; i++) {
                    runningTotal += LOTTERY_ODDS[teamsCopy[i].seed][pick];
                    if (random <= runningTotal) {
                        selectedIndex = i;
                        break;
                    }
                }
                
                // If somehow no team was selected, pick the last one
                if (selectedIndex === -1) selectedIndex = teamsCopy.length - 1;
                
                // Add the team to the draft order
                const selectedTeam = teamsCopy[selectedIndex];
                draftOrder.push(selectedTeam);
                debugData.push(`‚Üí Selected ${selectedTeam.code} (${selectedTeam.seed})`);
                
                // Log to console for debugging
                console.log(`Pick ${pick+1}: Selected ${selectedTeam.code} with random ${random.toFixed(2)}/${totalOdds.toFixed(2)}`);
                
                // Remove the team from the pool
                teamsCopy.splice(selectedIndex, 1);
            }
            
            // Sort remaining teams by seed for picks 5-14
            teamsCopy.sort((a, b) => a.seed - b.seed);
            draftOrder.push(...teamsCopy);
            
            // Log the complete draft order
            const fullOrder = draftOrder.map(team => team.code).join(", ");
            console.log("Full draft order:", fullOrder);
            debugData.push(`Final order: ${fullOrder}`);
            
            // Update debug info
            debugInfo.innerHTML += debugData.join('<br>');
            
            return draftOrder;
        }
        
        // Display the results of the lottery
        function displayResults(draftOrder) {
            draftOrder.forEach((team, index) => {
                const pickNumber = 14 - index;
                const isLotteryPick = pickNumber <= 4;
                
                const row = document.createElement('div');
                row.className = `result-row ${isLotteryPick ? 'lottery' : ''}`;
                
                // Calculate movement
                const movement = team.seed - (14 - index);
                const movementClass = movement > 0 ? 'up' : 'down';
                const movementText = movement > 0 ? `(+${movement})` : `(${movement})`;
                
                row.innerHTML = `
                    <div class="pick-number">${pickNumber}</div>
                    <div class="team-logo" style="background-color: ${team.primary};">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="${team.secondary}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="${team.primary}" />
                        </svg>
                        <div class="team-code" style="color: ${team.secondary};">${team.code}</div>
                    </div>
                    <div class="team-info">
                        <p class="team-name">${team.name}</p>
                        <p class="team-odds">
                            Original Position: #${team.seed}
                            ${movement !== 0 ? `<span class="movement ${movementClass}">${movementText}</span>` : ''}
                        </p>
                    </div>
                    ${isLotteryPick ? '<div class="lottery-badge">Lottery Winner</div>' : ''}
                `;
                
                resultsContainer.appendChild(row);
            });
        }
        
        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
