<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Ultra Simple NBA Lottery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #1d428a;
        }
        .emoji {
            font-size: 36px;
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            background-color: #c8102e;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }
        button:hover {
            background-color: #a70d25;
        }
        .teams {
            margin-bottom: 20px;
        }
        .team {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        .lottery {
            background-color: #fff9e6;
        }
        .team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: bold;
        }
        .team-name {
            flex-grow: 1;
        }
        .pick-num {
            font-weight: bold;
            margin-right: 10px;
            width: 25px;
            height: 25px;
            background-color: #1d428a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .movement {
            margin-left: 5px;
        }
        .up {
            color: green;
        }
        .down {
            color: red;
        }
        .debug {
            margin-top: 30px;
            padding: 10px;
            border-top: 1px solid #ddd;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="emoji">üßä ‚úâÔ∏è</div>
    <h1>The Frozen Envelope Machine</h1>
    
    <button id="simulate-btn">Run The Lottery</button>
    
    <div id="results" class="hidden">
        <h2>Draft Results</h2>
        <div id="draft-order" class="teams"></div>
    </div>
    
    <div id="debug" class="debug"></div>
    
    <script>
        // Disable any caching
        document.addEventListener('DOMContentLoaded', function() {
            // Force disable cache
            window.onpageshow = function(event) {
                if (event.persisted) {
                    window.location.reload();
                }
            };
        });
        
        // Simple team data
        const teams = [
            { code: 'UTA', name: 'Utah Jazz', color: '#002B5C', odds: 14.0, seed: 1 },
            { code: 'WAS', name: 'Washington Wizards', color: '#002B5C', odds: 14.0, seed: 2 },
            { code: 'CHA', name: 'Charlotte Hornets', color: '#1D1160', odds: 14.0, seed: 3 },
            { code: 'NO', name: 'New Orleans Pelicans', color: '#0C2340', odds: 12.5, seed: 4 },
            { code: 'PHI', name: 'Philadelphia 76ers', color: '#006BB6', odds: 10.5, seed: 5 },
            { code: 'BKN', name: 'Brooklyn Nets', color: '#000000', odds: 9.0, seed: 6 },
            { code: 'TOR', name: 'Toronto Raptors', color: '#CE1141', odds: 7.5, seed: 7 },
            { code: 'SA', name: 'San Antonio Spurs', color: '#C4CED4', odds: 6.0, seed: 8 },
            { code: 'PHX', name: 'Phoenix Suns', color: '#1D1160', odds: 4.5, seed: 9 },
            { code: 'POR', name: 'Portland Trail Blazers', color: '#E03A3E', odds: 3.0, seed: 10 },
            { code: 'DAL', name: 'Dallas Mavericks', color: '#00538C', odds: 2.0, seed: 11 },
            { code: 'CHI', name: 'Chicago Bulls', color: '#CE1141', odds: 1.5, seed: 12 },
            { code: 'SAC', name: 'Sacramento Kings', color: '#5A2D81', odds: 1.0, seed: 13 },
            { code: 'ATL', name: 'Atlanta Hawks', color: '#E03A3E', odds: 0.5, seed: 14 }
        ];
        
        // Get DOM elements
        const simulateBtn = document.getElementById('simulate-btn');
        const resultsDiv = document.getElementById('results');
        const draftOrderDiv = document.getElementById('draft-order');
        const debugDiv = document.getElementById('debug');
        
        // Get a random number
        function getRandom() {
            // Use multiple sources of randomness
            const r1 = Math.random();
            const r2 = performance.now() / 1000 % 1;
            const r3 = new Date().getMilliseconds() / 1000;
            return (r1 + r2 + r3) / 3;
        }
        
        // Simulation counter
        let simCount = 0;
        
        // Run the lottery
        simulateBtn.addEventListener('click', function() {
            // Update counter
            simCount++;
            
            // Clear results
            debugDiv.textContent = '';
            draftOrderDiv.innerHTML = '';
            
            // Disable button
            simulateBtn.disabled = true;
            simulateBtn.textContent = 'Simulating...';
            
            // Add timestamp to debug
            const now = new Date();
            const timestamp = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}.${now.getMilliseconds()}`;
            debugDiv.textContent += `Simulation #${simCount} at ${timestamp}\n`;
            
            // Delay to simulate processing time
            setTimeout(function() {
                // Make a copy of the teams
                const teamsCopy = JSON.parse(JSON.stringify(teams));
                const draftOrder = [];
                
                // Simulate top 4 picks
                for (let pick = 1; pick <= 4; pick++) {
                    const totalOdds = teamsCopy.reduce((sum, team) => sum + team.odds, 0);
                    
                    // Get random number
                    const rand = getRandom() * totalOdds;
                    debugDiv.textContent += `Pick ${pick}: Random ${rand.toFixed(2)}/${totalOdds.toFixed(2)}\n`;
                    
                    // Determine which team gets the pick
                    let runningTotal = 0;
                    let selectedIndex = -1;
                    
                    for (let i = 0; i < teamsCopy.length; i++) {
                        runningTotal += teamsCopy[i].odds;
                        if (rand <= runningTotal) {
                            selectedIndex = i;
                            break;
                        }
                    }
                    
                    // Fallback if no team selected (shouldn't happen)
                    if (selectedIndex === -1) selectedIndex = teamsCopy.length - 1;
                    
                    // Add selected team to draft order
                    const selectedTeam = teamsCopy[selectedIndex];
                    draftOrder.push(selectedTeam);
                    
                    // Debug log
                    debugDiv.textContent += `‚Üí Selected ${selectedTeam.code} (seed #${selectedTeam.seed})\n`;
                    
                    // Remove team from pool
                    teamsCopy.splice(selectedIndex, 1);
                }
                
                // Sort remaining teams by seed (worst to best)
                teamsCopy.sort((a, b) => a.seed - b.seed);
                
                // Add remaining teams to draft order
                draftOrder.push(...teamsCopy);
                
                // Display the results
                draftOrder.forEach((team, index) => {
                    // Calculate pick number (14 down to 1)
                    const pickNumber = 14 - index;
                    
                    // Create team element
                    const teamDiv = document.createElement('div');
                    teamDiv.className = 'team' + (pickNumber <= 4 ? ' lottery' : '');
                    
                    // Calculate movement
                    const movement = team.seed - (14 - index);
                    const movementText = movement > 0 ? `(+${movement})` : movement < 0 ? `(${movement})` : '';
                    const movementClass = movement > 0 ? 'up' : movement < 0 ? 'down' : '';
                    
                    teamDiv.innerHTML = `
                        <div class="pick-num">${pickNumber}</div>
                        <div class="team-logo" style="background-color: ${team.color};">${team.code}</div>
                        <div class="team-name">
                            ${team.name}
                            <div style="font-size: 0.8em; color: #666;">
                                Original Position: #${team.seed}
                                ${movement !== 0 ? `<span class="movement ${movementClass}">${movementText}</span>` : ''}
                            </div>
                        </div>
                        ${pickNumber <= 4 ? '<div style="font-size: 0.8em; color: #856404; background: #ffeeba; padding: 3px 8px; border-radius: 10px;">Lottery Winner</div>' : ''}
                    `;
                    
                    draftOrderDiv.appendChild(teamDiv);
                });
                
                // Debug log the final order
                debugDiv.textContent += `Final order: ${draftOrder.map(t => t.code).join(', ')}\n`;
                
                // Show results
                resultsDiv.classList.remove('hidden');
                
                // Reset button
                simulateBtn.disabled = false;
                simulateBtn.textContent = 'Run The Lottery';
                
            }, 1000);
        });
    </script>
</body>
</html>
