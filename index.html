<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Frozen Envelope Machine | NBA Draft Lottery Simulator | galaxyhole</title>
    
    <!-- Add React and ReactDOM from unpkg to ensure compatibility -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Add Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.10/babel.min.js"></script>
    
    <!-- Add Lucide Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script>
        // Make sure Lucide is available globally
        window.LucideIcons = window.lucide || {};
    </script>
    
    <!-- Add Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @keyframes fall {
          0% {
            transform: translateY(0) rotate(0deg);
          }
          100% {
            transform: translateY(1000px) rotate(720deg);
          }
        }
        
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
          }
          50% {
            transform: scale(1.05);
          }
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f7f8fa;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .falling-confetti {
            position: absolute;
            animation: fall 3s linear forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="root"></div>
    </div>
    
    <script type="text/babel">
        // Create a React component for the NBA Draft Lottery Simulator
        const TEAM_COLORS = {
          UTA: { primary: '#002B5C', secondary: '#F9A01B', name: 'Utah Jazz' },
          WAS: { primary: '#002B5C', secondary: '#E31837', name: 'Washington Wizards' },
          CHA: { primary: '#1D1160', secondary: '#00788C', name: 'Charlotte Hornets' },
          NO: { primary: '#0C2340', secondary: '#C8102E', name: 'New Orleans Pelicans' },
          PHI: { primary: '#006BB6', secondary: '#ED174C', name: 'Philadelphia 76ers' },
          BKN: { primary: '#000000', secondary: '#FFFFFF', name: 'Brooklyn Nets' },
          TOR: { primary: '#CE1141', secondary: '#000000', name: 'Toronto Raptors' },
          SA: { primary: '#C4CED4', secondary: '#000000', name: 'San Antonio Spurs' },
          PHX: { primary: '#1D1160', secondary: '#E56020', name: 'Phoenix Suns' },
          POR: { primary: '#E03A3E', secondary: '#000000', name: 'Portland Trail Blazers' },
          DAL: { primary: '#00538C', secondary: '#002B5E', name: 'Dallas Mavericks' },
          CHI: { primary: '#CE1141', secondary: '#000000', name: 'Chicago Bulls' },
          SAC: { primary: '#5A2D81', secondary: '#63727A', name: 'Sacramento Kings' },
          ATL: { primary: '#E03A3E', secondary: '#C1D32F', name: 'Atlanta Hawks' }
        };

        // Lottery odds from Tankathon
        const LOTTERY_ODDS = {
          UTA: { team: 'UTA', odds: [14.0, 13.4, 12.7, 12.0, 47.9], seed: 1 },
          WAS: { team: 'WAS', odds: [14.0, 13.4, 12.7, 12.0, 27.8, 20.0], seed: 2 },
          CHA: { team: 'CHA', odds: [14.0, 13.4, 12.7, 12.0, 14.8, 26.0, 7.0], seed: 3 },
          NO: { team: 'NO', odds: [12.5, 12.2, 11.9, 11.5, 7.2, 25.7, 16.7, 2.2], seed: 4 },
          PHI: { team: 'PHI', odds: [10.5, 10.5, 10.6, 10.5, 2.2, 19.6, 26.7, 8.7, 0.6], seed: 5 },
          BKN: { team: 'BKN', odds: [9.0, 9.2, 9.4, 9.6, 8.6, 29.8, 20.5, 3.7, 0.1], seed: 6 },
          TOR: { team: 'TOR', odds: [7.5, 7.8, 8.1, 8.5, 19.7, 34.1, 12.9, 1.3, 0.1], seed: 7 },
          SA: { team: 'SA', odds: [6.0, 6.3, 6.7, 7.2, 34.5, 32.1, 6.7, 0.4, 0.1], seed: 8 },
          PHX: { team: 'PHX', odds: [4.5, 4.8, 5.2, 5.7, 50.7, 25.9, 3.0, 0.1, 0.1], seed: 9 },
          POR: { team: 'POR', odds: [3.0, 3.3, 3.6, 4.0, 65.9, 19.0, 1.2], seed: 10 },
          DAL: { team: 'DAL', odds: [2.0, 2.2, 2.4, 2.8, 77.6, 12.6, 0.4], seed: 11 },
          CHI: { team: 'CHI', odds: [1.5, 1.7, 1.9, 2.1, 86.1, 6.7], seed: 12 },
          SAC: { team: 'SAC', odds: [1.0, 1.1, 1.2, 1.4, 92.9, 2.3], seed: 13 },
          ATL: { team: 'ATL', odds: [0.5, 0.6, 0.6, 0.7, 97.6], seed: 14 }
        };

        // Team Logo Component
        const TeamLogo = ({ teamCode, size = 48 }) => {
          const colors = TEAM_COLORS[teamCode];
          
          // Create a custom shield icon
          const renderShield = () => {
            return (
              <svg 
                width={size * 0.7} 
                height={size * 0.7} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={colors.secondary}
                strokeWidth="3"
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill={colors.primary} />
              </svg>
            );
          };
          
          return (
            <div className="flex items-center justify-center" style={{ width: size, height: size }}>
              <div 
                className="relative flex items-center justify-center rounded-full"
                style={{ 
                  backgroundColor: colors.primary,
                  width: size,
                  height: size
                }}
              >
                {renderShield()}
                <div 
                  className="absolute font-bold text-center" 
                  style={{ 
                    color: colors.secondary,
                    fontSize: size * 0.3
                  }}
                >
                  {teamCode}
                </div>
              </div>
            </div>
          );
        };

        // Confetti Component
        const Confetti = ({ showConfetti }) => {
          const [particles, setParticles] = React.useState([]);
          
          React.useEffect(() => {
            if (showConfetti) {
              const newParticles = [];
              for (let i = 0; i < 100; i++) {
                newParticles.push({
                  id: i,
                  x: Math.random() * 100,
                  y: -Math.random() * 20 - 10,
                  size: Math.random() * 8 + 4,
                  color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                  speed: Math.random() * 3 + 2
                });
              }
              setParticles(newParticles);
            } else {
              setParticles([]);
            }
          }, [showConfetti]);
          
          return (
            <div className="absolute inset-0 overflow-hidden pointer-events-none">
              {particles.map(particle => (
                <div 
                  key={particle.id}
                  className="absolute rounded-sm falling-confetti"
                  style={{
                    left: `${particle.x}%`,
                    top: `${particle.y}%`,
                    width: `${particle.size}px`,
                    height: `${particle.size}px`,
                    backgroundColor: particle.color,
                    animationDuration: `${particle.speed}s`
                  }}
                />
              ))}
            </div>
          );
        };

        // Main Component
        const DraftLotterySimulator = () => {
          const [simulatedOrder, setSimulatedOrder] = React.useState([]);
          const [isSimulating, setIsSimulating] = React.useState(false);
          const [showConfetti, setShowConfetti] = React.useState(false);
          const [simulationCount, setSimulationCount] = React.useState(0);
          
          // This is the key function that simulates the draft
          const simulateDraft = () => {
            setIsSimulating(true);
            setSimulatedOrder([]);
            setSimulationCount(prev => prev + 1); // Increment counter to force re-simulation
            
            // Simulate with delay for each pick for dramatic effect
            setTimeout(() => {
              try {
                // Clone the lottery odds to avoid any reference issues
                const teamsData = {};
                Object.keys(LOTTERY_ODDS).forEach(key => {
                  teamsData[key] = {
                    ...LOTTERY_ODDS[key],
                    odds: [...LOTTERY_ODDS[key].odds] // Create a new array
                  };
                });
                
                const teamsList = Object.values(teamsData);
                const newOrder = [];
                console.log(`Starting simulation #${simulationCount + 1}`);
                
                // Simulate the first 4 picks (lottery picks)
                let remainingTeams = [...teamsList];
                
                for (let pick = 1; pick <= 4; pick++) {
                  // Calculate total odds for remaining teams
                  const totalOdds = remainingTeams.reduce((sum, team) => sum + team.odds[pick-1], 0);
                  
                  // Get a random number between 0 and totalOdds
                  const random = Math.random() * totalOdds;
                  console.log(`Pick ${pick}: Random value ${random.toFixed(2)} / Total ${totalOdds.toFixed(2)}`);
                  
                  // Find the team that got the pick
                  let runningTotal = 0;
                  let selectedTeamIndex = -1;
                  
                  for (let i = 0; i < remainingTeams.length; i++) {
                    runningTotal += remainingTeams[i].odds[pick-1];
                    if (random <= runningTotal) {
                      selectedTeamIndex = i;
                      break;
                    }
                  }
                  
                  if (selectedTeamIndex === -1) {
                    selectedTeamIndex = remainingTeams.length - 1; // Fallback to the last team if nothing found
                  }
                  
                  // Add the team to the draft order
                  console.log(`Pick ${pick}: Selected ${remainingTeams[selectedTeamIndex].team}`);
                  newOrder.push({...remainingTeams[selectedTeamIndex]});
                  
                  // Remove the team from the remaining teams (create a new array)
                  remainingTeams = remainingTeams.filter((_, index) => index !== selectedTeamIndex);
                }
                
                // For the remaining picks, use the inverse order of team records (already sorted)
                remainingTeams.sort((a, b) => a.seed - b.seed);
                newOrder.push(...remainingTeams);
                
                // Debug output the full draft order
                console.log("Full draft order:", newOrder.map(team => team.team).join(", "));
                
                // Update state with the simulated order
                setSimulatedOrder(newOrder);
              } catch (error) {
                console.error("Error in simulation:", error);
              } finally {
                setIsSimulating(false);
                setShowConfetti(true);
                
                // Hide confetti after a while
                setTimeout(() => {
                  setShowConfetti(false);
                }, 5000);
              }
            }, 1000);
          };
          
          return (
            <div className="relative flex flex-col items-center p-8 overflow-hidden bg-gray-100 rounded-lg shadow-xl min-h-96">
              <Confetti showConfetti={showConfetti} />
              
              <div className="text-center mb-8">
                <div className="text-6xl mb-2">🧊 ✉️</div>
                <h1 className="text-3xl font-bold text-center text-blue-800">The Frozen Envelope Machine</h1>
                <p className="text-gray-600 mt-1">NBA Draft Lottery Simulator</p>
              </div>
              
              <div className="w-full mb-8">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-semibold">Pre-Lottery Order (Worst to Best)</h2>
                  <p className="text-sm text-gray-600">Based on 2025 NBA Lottery Odds</p>
                </div>
                
                <div className="grid grid-cols-1 gap-2 md:grid-cols-2">
                  {Object.values(LOTTERY_ODDS).sort((a, b) => a.seed - b.seed).map(team => (
                    <div 
                      key={team.team} 
                      className="flex items-center p-3 bg-white rounded-lg shadow-md"
                    >
                      <div className="flex-shrink-0 mr-4">
                        <TeamLogo teamCode={team.team} size={36} />
                      </div>
                      <div className="flex-grow">
                        <div className="font-semibold">{TEAM_COLORS[team.team].name}</div>
                        <div className="text-sm text-gray-600">
                          {team.odds[0]}% chance at #1 pick
                        </div>
                      </div>
                      <div className="text-lg font-bold">
                        #{team.seed}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
              
              <button
                onClick={simulateDraft}
                disabled={isSimulating}
                className={`px-8 py-4 mb-8 text-xl font-bold text-white transition-transform rounded-full shadow-lg ${
                  isSimulating ? 'bg-gray-500' : 'bg-red-600 hover:bg-red-700 active:transform active:scale-95'
                }`}
                style={{
                  animation: isSimulating ? 'pulse 1s infinite' : 'none'
                }}
              >
                {isSimulating ? 'Freezing Envelopes...' : 'Run The Frozen Envelope Machine'}
              </button>
              
              {simulatedOrder.length > 0 && (
                <div className="w-full">
                  <h2 className="mb-4 text-xl font-semibold">Draft Results</h2>
                  <div className="overflow-hidden bg-white rounded-lg shadow-lg">
                    {simulatedOrder.map((team, index) => {
                      const pickNumber = 14 - index;
                      const isLotteryPick = pickNumber <= 4;
                      
                      return (
                        <div 
                          key={`${team.team}-${simulationCount}-${index}`}
                          className={`flex items-center p-4 border-b ${
                            isLotteryPick ? 'bg-yellow-50' : ''
                          }`}
                        >
                          <div className="flex items-center justify-center w-10 h-10 mr-4 font-bold text-white bg-blue-700 rounded-full">
                            {pickNumber}
                          </div>
                          <div className="flex-shrink-0 mr-4">
                            <TeamLogo teamCode={team.team} size={40} />
                          </div>
                          <div className="flex-grow">
                            <div className="text-lg font-semibold">{TEAM_COLORS[team.team].name}</div>
                            <div className="text-sm text-gray-600">
                              Original Position: #{team.seed}
                              {team.seed !== (14 - index) && (
                                <span className={team.seed > (14 - index) ? 'text-green-600 ml-2' : 'text-red-600 ml-2'}>
                                  {team.seed > (14 - index) ? `(+${team.seed - (14 - index)})` : `(${team.seed - (14 - index)})`}
                                </span>
                              )}
                            </div>
                          </div>
                          {isLotteryPick && (
                            <div className="px-3 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full">
                              Lottery Winner
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the app
        ReactDOM.render(<DraftLotterySimulator />, document.getElementById('root'));
    </script>d">{TEAM_COLORS[team.team].name}</div>
                        <div className="text-sm text-gray-600">
                          {team.odds[0]}% chance at #1 pick
                        </div>
                      </div>
                      <div className="text-lg font-bold">
                        #{team.seed}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
              
              <button
                onClick={simulateDraft}
                disabled={isSimulating}
                className={`px-8 py-4 mb-8 text-xl font-bold text-white transition-transform rounded-full shadow-lg ${
                  isSimulating ? 'bg-gray-500' : 'bg-red-600 hover:bg-red-700 active:transform active:scale-95'
                }`}
                style={{
                  animation: isSimulating ? 'pulse 1s infinite' : 'none'
                }}
              >
                {isSimulating ? 'Freezing Envelopes...' : 'Run The Frozen Envelope Machine'}
              </button>
              
              {simulatedOrder.length > 0 && (
                <div className="w-full">
                  <h2 className="mb-4 text-xl font-semibold">Draft Results</h2>
                  <div className="overflow-hidden bg-white rounded-lg shadow-lg">
                    {simulatedOrder.map((team, index) => {
                      const pickNumber = 14 - index;
                      const isLotteryPick = pickNumber <= 4;
                      
                      return (
                        <div 
                          key={team.team}
                          className={`flex items-center p-4 border-b ${
                            isLotteryPick ? 'bg-yellow-50' : ''
                          }`}
                        >
                          <div className="flex items-center justify-center w-10 h-10 mr-4 font-bold text-white bg-blue-700 rounded-full">
                            {pickNumber}
                          </div>
                          <div className="flex-shrink-0 mr-4">
                            <TeamLogo teamCode={team.team} size={40} />
                          </div>
                          <div className="flex-grow">
                            <div className="text-lg font-semibold">{TEAM_COLORS[team.team].name}</div>
                            <div className="text-sm text-gray-600">
                              Original Position: #{team.seed}
                              {team.seed !== (14 - index) && (
                                <span className={team.seed > (14 - index) ? 'text-green-600 ml-2' : 'text-red-600 ml-2'}>
                                  {team.seed > (14 - index) ? `(+${team.seed - (14 - index)})` : `(${team.seed - (14 - index)})`}
                                </span>
                              )}
                            </div>
                          </div>
                          {isLotteryPick && (
                            <div className="px-3 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full">
                              Lottery Winner
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the app
        ReactDOM.render(<DraftLotterySimulator />, document.getElementById('root'));
    </script>
</body>
</html>
